<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <Target Name="LibraryPropsMessage" BeforeTargets="Build">
        <Message Text="--- Building $(MSBuildProjectName) with Library.props included! ---" Importance="high"/>
    </Target>


    <!-- This PropertyGroup defines the $(ProjectNameUpper) for the project -->
    <PropertyGroup>
        <ProjectNameUpper>$(MSBuildProjectName.ToUpper())</ProjectNameUpper>
    </PropertyGroup>

    <!-- This PropertyGroup defines the path and content of the Exports.h file-->
    <PropertyGroup>
        <GeneratedHeader>$(ProjectDir)\Public\Generated\$(MSBuildProjectName)Exports.h</GeneratedHeader>
        <ExportHeaderContent>
            <![CDATA[
/* Automatically generated by MSBuild (/Common/Props/LibraryBuild.props) */
#pragma once

#if defined($(ProjectNameUpper)_EXPORTS)
    #define $(ProjectNameUpper)_API __declspec(dllexport)
#else
    #define $(ProjectNameUpper)_API __declspec(dllimport)
#endif
            ]]>
        </ExportHeaderContent>
    </PropertyGroup>

    <!-- This target generates the Exports.h file -->
    <Target Name="GenerateExportHeader" BeforeTargets="ClCompile">
        <WriteLinesToFile
                File="$(GeneratedHeader)"
                Overwrite="true"
                Lines="$(ExportHeaderContent)"/>

        <MakeDir Directories="$(ProjectDir)\Private"/>
        <MakeDir Directories="$(ProjectDir)\Public"/>
        <MakeDir Directories="$(ProjectDir)\Public\Generated"/>

    </Target>

    <!-- This ItemGroup ensures Exports.h is included in the project -->
    <ItemGroup>
        <!-- this prevents you from excluding or deleting exports.h or any containing folders. 
             I haven't decided whether what the best choice is here.
             Maybe just need to put it in root and then it doesn't matter
             Or a generated folder that is ignored by git? 
             I think it needs to be public so that it can be included by other projects
             so currently thinking might as well keep it in \Public\ but don't include it in project.
             todo: define the directory as a variable so we can use it above and here.
        <ClInclude Include="$(GeneratedHeader)"/>-->
    </ItemGroup>

    <!-- Setting the Public Include Directories -->
    <PropertyGroup>
        <PublicIncludeDirectories>$(ProjectDir)\Public;%(PublicIncludeDirectories)</PublicIncludeDirectories>
    </PropertyGroup>

    <!-- Define PreprocessorDefinitions and Includes for library (dll) projects -->
    <ItemDefinitionGroup>
        <ClCompile>
            <PreprocessorDefinitions>$(ProjectNameUpper)_EXPORTS;%(PreprocessorDefinitions)</PreprocessorDefinitions>
            <AdditionalIncludeDirectories>$(ProjectDir)\Public;$(ProjectDir)\Private;%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>
            <AdditionalPublicIncludeDirectories>%(AdditionalPublicIncludeDirectories);$(ProjectDir)\Public;</AdditionalPublicIncludeDirectories>
        </ClCompile>
    </ItemDefinitionGroup>
    

    
</Project>
